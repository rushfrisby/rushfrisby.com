<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>Expiring links after a given timeframe</title>
<meta name="HandheldFriendly" content="True" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" type="text/css" href="/css/site.css" />
<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
<meta property="og:site_name" content="Rush Frisby" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Expiring links after a given timeframe" />
<meta name="twitter:title" content="Expiring links after a given timeframe" />
<meta name="twitter:data1" content="Rush Frisby" />
</head>
<body class="post-template">
<header id="header">
<nav class="header-nav" ">
<div class="blog-title"><a href="/">Rush Frisby</a></div>
<div class="blog-description">Thoughts on software and technology.</div>

<div class="taglist-wrapper clearfix">
<ul id="taglist" class="taglist">
<li class="nav-home" role="presentation">
<a href="/">Home</a>
</li>
<li class="nav-about" role="presentation">
<a href="/about">About</a>
</li>
<li class="nav-mechanical-keyboards" role="presentation">
<a href="/mechanical-keyboards">Mechanical Keyboards</a>
</li>
<li class="nav-about" role="presentation">
<a href="/tags">Tags</a>
</li>
<li class="nav-about" role="presentation">
<a href="/archive">Archive</a>
</li>
</ul>
</div>
</nav>
</header>
<main id="content" class="content" role="main">
<div id="article" class="box ">
<article class='post'>
<header class='post-header'>
<a href='/expiring-links-after-a-given-timeframe'><h1 class='post-title'>Expiring links after a given timeframe</h1></a>
<section class='post-meta'>
<time class='post-date' datetime='2014-09-08'>Monday, September 8, 2014</time>
</section>
</header>
<section class='post-content'>
<p>Here is one way to expire a link/web page after a certain amount of time has passed. Instead of keeping track of whether a link is valid or not through a database look-up, this is done by verifying that the expiration date in the url generates the same token that is also passed in through the url. If the user tries to change the date value it will invalidate the token. Users cannot generate the token without the secret key you keep on your server. Here is how it’s done.</p>

<p>First we need to create a model for our expiration date and token:</p>

<p>public class ExpiresModel { public DateTime ExpiresOn { get; set; } public string Token { get; set; } }</p>

<p>Next we need a utility for generating and checking tokens:</p>

<p>public class TokenHelper { private const string HashKey = "secret"; public static string GetToken(ExpiresModel model) { if(model <mark> null) throw new ArgumentNullException("model"); return Crypto.HashSHA512(String.Format("{0}_{1}", HashKey, model.ExpiresOn.Ticks)); } public static bool IsValidToken(ExpiresModel model) { if (model </mark> null) throw new ArgumentNullException("model"); return model.Token == GetToken(model); } }</p>

<p>Notice that in the TokenHelper class is where the secret key lives. The Crypto class I used can be found <a href="/c-cryptography-library-md5-sha1-sha2-aes-3des/">here</a>.</p>

<p>For the front end I have one page which creates the link and another to check the status. Here is the controller for that:</p>

<p>public class HomeController : Controller { public ActionResult Index() { var model = new ExpiresModel(); model.ExpiresOn = DateTime.Now.AddSeconds(30); model.Token = TokenHelper.GetToken(model); return View(model); } public ActionResult Check(long dateData, string token) { var model = new ExpiresModel(); model.ExpiresOn = DateTime.FromBinary(dateData); model.Token = token; if (!TokenHelper.IsValidToken(model)) ViewBag.Message = "Invalid!"; else if (model.ExpiresOn >= DateTime.Now) ViewBag.Message = "Still good: Expires in " + (model.ExpiresOn - DateTime.Now); else ViewBag.Message = "Not good: Expired on " + model.ExpiresOn; return View(); } }</p>

<p>And the Views for those controller methods… <br />
 Index:</p>

<p>@model WebApplication4.Models.ExpiresModel @{ ViewBag.Title = "Home"; Layout = "~/Views/Shared/_Layout.cshtml"; } <h3>Home</h3> <p>A new link has been generated that expires in 30 seconds. Use the link below to check the status:</p> <p><a href="@Url.Action("Check", new { dateData = Model.ExpiresOn.ToBinary(), token = Model.Token })">Check Now</a></p></p>

<p>Check:</p>

<p>@{ ViewBag.Title = "Check"; Layout = "~/Views/Shared/_Layout.cshtml"; } <h3>Check</h3> <p>@ViewBag.Message</p> <p>@Html.ActionLink("Gernate another link", "Index", "Home", new { area = "" }, null)</p></p>

<p>The entire solution can be downloaded <a href="http://rushfrisby.com/wp-content/uploads/2014/09/ExpiringLinksExampleSln.zip">here</a>.</p>

<p><strong>Update 12/30/2015:</strong><a href="https://www.webucator.com">Webucator.com</a> asked me if they could create a video on this blog post which I agreed to. You can <a href="https://www.youtube.com/watch?v=rRBkQUnXrTM">check out the video on youtube here</a>. It turned out great! Webucator has more good <a href="https://www.webucator.com/microsoft-training/csharp.cfm">C# training material</a> on their website as well. The video on this blog post is part of their “<a href="https://www.webucator.com/self-paced-courses/course/c-sharp-solutions-from-the-web.cfm">C# Solutions from the Web</a>” course, which is free!</p>
</section>
<footer class='post-footer'>
</footer>
<div id="disqus_thread"></div>
<script>
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://rushfrisby.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
</article>

</div>
<div id="sidebar"><div class="box sidebox about">
<div class="sidebox-title">About</div>
<div class="sidebox-content">
<p class="center"><img src="/img/rush_headshot_2018_256-min.jpg" title="Rush Frisby" alt="Rush Frisby" width="256" height="256" /></p>
<p>Rush is a software architect who loves solving problems. You'll usually find him writing about security concepts and sharing solutions to problems he's faced.</p>
</div>
</div>
<div class="sidebox box social clearfix">
<ul>
<a href="/rss" target="_blank" class="social-item rss"><li><i class="fa fa-rss fa-fw"></i></li></a>
<a href="https://twitter.com/rushonerok" target="_blank" class="social-item tw"><li><i class="fa fa-twitter fa-fw"></i></li></a>
<a href="http://github.com/rushfrisby" class="social-item github"><li><i class="fa fa-github fa-fw"></i></li></a>
<a href="/" class="social-item home"><li><i class="fa fa-home fa-fw"></i></li></a>
</ul>
</div>
<div class='box sidebox latest-articles'>
<div class='sidebox-title'>Latest Articles</div>
<div class='sidebox-content'>
<a href='/interface-to-rpc-service'><div class='date'>2 AUG 2018</div><div>Interface to RPC Service</div></a>
<a href='/losing-our-memory'><div class='date'>8 DEC 2017</div><div>Losing Our Memory</div></a>
<a href='/are-coding-bootcamps-worth-it'><div class='date'>20 AUG 2017</div><div>Are Coding Bootcamps Worth It?</div></a>
<a href='/meetup-using-protobuf-in-net'><div class='date'>8 AUG 2017</div><div>Meetup: Using Protobuf in .NET</div></a>
<a href='/application-security-and-single-sign-on'><div class='date'>16 DEC 2016</div><div>Application Security and Single Sign On</div></a>
</div>
</div>

</main>
<footer class="site-footer clearfix">
<section class="copyright"><a href="https://rushfrisby.com">Rush Frisby</a> &copy; 2018</section>
<section class="poweredby">Proudly <a href="https://github.com/rushfrisby/rushfrisby.com">published with my own blog engine on github</a></section>
</footer>
<script type="text/javascript" src="/js/jquery.min.js"></script>
<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
</body>
</html>
